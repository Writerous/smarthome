<ng-container *ngIf="rooms$ | async as rooms">
	<mat-horizontal-stepper #stepper>
		<mat-step>
			<ng-template matStepLabel>
				Укажите причину
			</ng-template>
			<form>
				<div class="form-column">
					<button
						type="button"
						mat-button
						[matMenuTriggerFor]="roomsMenu"
						[matMenuTriggerData]="{ roomArray: rooms }"
					>
						Выберите сенсор
					</button>
					<app-equipment
						*ngIf="aboutEventSensor"
						size="small"
						[equipment]="aboutEventSensor?.equipment"
						[hardware]="aboutEventSensor?.hardware"
						[room]="aboutEventSensor?.room"
					></app-equipment>
				</div>
				<div class="form-column">
					<div>
						<mat-form-field class="mat-form-field-flex" appearance="fill">
							<mat-label>Значение </mat-label>
							<input type="text" matInput placeholder="Значение" />
						</mat-form-field>
						<mat-form-field appearance="fill" class="mat-form-field-flex">
							<mat-label>
								Сравнение
							</mat-label>
							<mat-select>
								<mat-option *ngFor="let comp of comparisons" [value]="comp.sign">
									{{ comp.label }}
								</mat-option>
							</mat-select>
						</mat-form-field>
					</div>
					<mat-card class="mat-elevation-z0" *ngIf="aboutEventSensor"
						>{{ aboutEventSensor?.equipment?.type }} будет {{ 'больше' }}
						{{ 60 | unit: aboutEventSensor?.equipment }}</mat-card
					>
				</div>
			</form>

			<button mat-button matStepperNext>Далее</button>
		</mat-step>
		<mat-step>
			<ng-template matStepLabel>
				Обработайте результат
			</ng-template>
			<button mat-button>Готово!</button>
		</mat-step>
	</mat-horizontal-stepper>

	<mat-menu #roomsMenu>
		<ng-template matMenuContent let-roomArray="roomArray">
			<ng-container *ngFor="let room of roomArray">
				<button
					mat-menu-item
					*ngIf="!!room?.hardwares?.length"
					[matMenuTriggerFor]="hardwaresMenu"
					[matMenuTriggerData]="{ hardwareArray: room?.hardwares, room: room }"
				>
					{{ room?.name }}
				</button>
			</ng-container>
		</ng-template>
	</mat-menu>

	<mat-menu #hardwaresMenu>
		<ng-template matMenuContent let-hardwareArray="hardwareArray" let-room="room">
			<button
				mat-menu-item
				*ngFor="let hardware of hardwareArray"
				[matMenuTriggerFor]="equipmentsMenu"
				[matMenuTriggerData]="{
					equipmentArray: hardware?.equipments,
					hardware: hardware,
					room: room
				}"
			>
				{{ hardware?.name }}
			</button>
		</ng-template>
	</mat-menu>

	<mat-menu #equipmentsMenu>
		<ng-template
			matMenuContent
			let-equipmentArray="equipmentArray"
			let-room="room"
			let-hardware="hardware"
		>
			<button
				mat-menu-item
				*ngFor="let equipment of equipmentArray"
				(click)="
					aboutEventSensor = { room: room, hardware: hardware, equipment: equipment }
				"
			>
				{{ equipment?.name || equipment?.id }}
			</button>
		</ng-template>
	</mat-menu>
</ng-container>
